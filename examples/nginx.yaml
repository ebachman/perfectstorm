- group:
    name: nginx
    query:
      type: swarm-task
      image:
        $regex: '^library/nginx:'

- application:
    name: nginx
    components:
      - nginx

- procedure:
    name: nginx-create
    type: swarm
    content: |
      - service create
        --name nginx
        --mode global
        --publish 80:80
        --health-cmd 'nginx -t'
        --health-interval 5s
        nginx

- procedure:
    name: nginx-destroy
    type: swarm
    content: |
      - service rm nginx
